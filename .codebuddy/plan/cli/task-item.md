# 实施计划

- [ ] 1. 创建 CLI 项目基础结构
   - 在 crates 目录下创建 cli 子项目目录结构
   - 配置 Cargo.toml，添加 wasmtime v41、clap、serde、serde_json 等依赖
   - 创建基本的 main.rs 文件框架
   - _需求：1_

- [ ] 2. 实现命令行参数解析
   - 使用 clap 定义命令行接口：WASM 文件路径、函数名称、JSON 参数列表
   - 实现帮助信息和用法说明的显示
   - 实现必需参数验证（WASM 文件路径为必填）
   - 实现参数解析错误处理，返回非零退出码
   - _需求：1_

- [ ] 3. 实现 WASM Component 文件加载
   - 使用 wasmtime v41 的 Component API 加载 WASM Component 文件
   - 实现文件存在性检查和可读性验证
   - 实现 WASM Component 格式验证
   - 提供详细的文件加载错误信息（文件不存在、格式错误等）
   - _需求：2_

- [ ] 4. 实现 JSON 参数解析和转换
   - 使用 serde_json 解析命令行传入的 JSON 字符串参数
   - 实现参数按位置排序
   - 实现参数有效性验证（JSON 格式检查）
   - 提供详细的 JSON 解析错误信息（格式错误、位置信息）
   - _需求：4_

- [ ] 5. 实现 WASM 函数查找和元数据获取
   - 使用 wasmtime v41 API 从 Component 中导出函数列表
   - 实现函数名称查找和存在性验证
   - 获取函数签名信息（参数类型和数量）
   - 提供可用函数列表用于错误提示
   - _需求：3_

- [ ] 6. 实现函数执行核心逻辑
   - 创建 wasmtime v41 引擎和存储
   - 实例化 WASM Component
   - 实现参数类型转换（从 JSON 到 WASM 值）
   - 调用指定函数并捕获执行结果
   - 处理函数执行时的 panic 和错误
   - _需求：3_

- [ ] 7. 实现参数类型匹配和数量验证
   - 根据函数签名验证传入参数的数量
   - 实现 JSON 类型到 WASM 类型的转换和匹配
   - 提供参数类型不匹配的详细错误信息
   - 提供参数数量错误的提示
   - _需求：4_

- [ ] 8. 实现 JSON 格式输出
   - 定义输出结果的数据结构（成功/失败、结果数据、错误信息）
   - 使用 serde_json 将执行结果序列化为 JSON 格式
   - 将 JSON 结果输出到标准输出
   - 确保输出格式符合标准 JSON 规范
   - _需求：5_

- [ ] 9. 编写单元测试
   - 为命令行参数解析功能编写测试用例
   - 为 JSON 参数解析编写测试用例
   - 为参数类型转换编写测试用例
   - 为错误处理逻辑编写测试用例
   - _需求：1、4_

- [ ] 10. 编写集成测试和示例
   - 创建简单的 WASM Component 示例文件用于测试
   - 编写完整的 CLI 使用场景集成测试
   - 测试正常执行流程（成功调用函数）
   - 测试各种错误场景（文件不存在、函数不存在、参数错误）
   - 编写 README 文档说明使用方法和示例
   - _需求：1、2、3、4、5_
